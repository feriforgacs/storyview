const ffStoryviewGap=40,ffStoryviewCodeBlockBottomGap=60;let ffStoryviewCurrentStory=0;const ffStoryviewBody=document.querySelector("body"),ffStoryviewDisplayButton=document.querySelector("#ff_storyview_button"),ffStoryviewCloseButton=document.querySelector("#ff_storyview_close_button");function toggleStoryview(e){e.preventDefault(),ffStoryviewBody.classList.contains("ff_storyview_visible")?(ffStoryviewBody.classList.remove("ff_storyview_visible"),history.pushState("storyview",document.title,window.location.href.split("#")[0])):(ffStoryviewBody.classList.add("ff_storyview_visible"),history.pushState("storyview",document.title+" Storyview","#storyview")),setSizes()}ffStoryviewDisplayButton.addEventListener("click",toggleStoryview),ffStoryviewCloseButton.addEventListener("click",toggleStoryview);const ffStoryviewBlocks=document.querySelector("#ff_storyview_blocks");ffStoryviewBlocks.addEventListener("click",stepStoryview);const ffStoryviewBlocksContainer=document.querySelector("#ff_storyview_blocks_items_container"),ffStoryviewBlockItems=document.querySelectorAll(".ff_storyview_block_item_content"),ffStoryviewBlockCodeItems=document.querySelectorAll(".ff_storyview_block_item_content_code"),ffStoryviewBlockItemsCount=ffStoryviewBlockItems.length+ffStoryviewBlockCodeItems.length;let ffStoryviewBlockWidth=window.innerWidth<420?window.innerWidth:420,ffStoryviewBlockHeight=window.innerHeight<746?window.innerHeight:746;function setSizes(){ffStoryviewBlockWidth=window.innerWidth<420?window.innerWidth:420,ffStoryviewBlockHeight=window.innerHeight<746?window.innerHeight:746;let width=ffStoryviewBlockWidth*ffStoryviewBlockItemsCount;ffStoryviewBlocksContainer.style.width=width+"px",ffStoryviewBlockItems.forEach(ffStoryviewBlockItem=>{ffStoryviewBlockItem.style.width=ffStoryviewBlockWidth+"px";let blockHeight=ffStoryviewBlockHeight-ffStoryviewGap;ffStoryviewBlockItem.style.height=blockHeight+"px"}),ffStoryviewBlockCodeItems.forEach(ffStoryviewBlockItem=>{ffStoryviewBlockItem.style.width=ffStoryviewBlockWidth+"px";let blockHeight=ffStoryviewBlockHeight-ffStoryviewGap;ffStoryviewBlockItem.style.height=blockHeight+"px";let codeBlock=ffStoryviewBlockItem.querySelector(".ff_storyview_block_item_code"),codeBlockHeight=blockHeight-ffStoryviewCodeBlockBottomGap;codeBlock.style.height=codeBlockHeight+"px"})}function stepStoryview(event=null,direction=null){if(event&&event.target.closest(".ff_storyview_block_item_content_code")&&!direction)return;if(event&&"ff_storyview_close_button"==event.target.id)return;let ffStoryviewBlocksPosition=ffStoryviewBlocks.getBoundingClientRect(),ffStoryviewBlocksLeftMax=ffStoryviewBlocksPosition.left+ffStoryviewBlocksPosition.width/2;if(event&&event.clientX>ffStoryviewBlocksLeftMax||"next"==direction){if(ffStoryviewCurrentStory<ffStoryviewBlockItemsCount-1){let left=(ffStoryviewCurrentStory+1)*ffStoryviewBlockWidth;ffStoryviewBlocksContainer.style.transform="translateX(-"+left+"px)",ffStoryviewCurrentStory++}updateIndicator("next")}else{if(ffStoryviewCurrentStory>0){let left=ffStoryviewCurrentStory*ffStoryviewBlockWidth-ffStoryviewBlockWidth;ffStoryviewBlocksContainer.style.transform="translateX(-"+left+"px)",ffStoryviewCurrentStory--}updateIndicator("previous")}}setSizes();const codeBlockPreviousButtons=document.querySelectorAll(".code_block_previous"),codeBlockNextButtons=document.querySelectorAll(".code_block_next");function updateIndicator(direction){if("next"==direction){let previousStoryIndicator=ffStoryviewCurrentStory-1;document.querySelector("#ff_storyview_block_indicator_item_"+previousStoryIndicator).classList.remove("activ"),document.querySelector("#ff_storyview_block_indicator_item_"+ffStoryviewCurrentStory).classList.add("activ")}else if("previous"==direction){let nextStoryIndicator=ffStoryviewCurrentStory+1;document.querySelector("#ff_storyview_block_indicator_item_"+nextStoryIndicator).classList.remove("activ"),document.querySelector("#ff_storyview_block_indicator_item_"+ffStoryviewCurrentStory).classList.add("activ")}}codeBlockPreviousButtons.forEach(codeBlockPreviousButton=>{codeBlockPreviousButton.addEventListener("click",event=>{stepStoryview(event,"previous")})}),codeBlockNextButtons.forEach(codeBlockNextButton=>{codeBlockNextButton.addEventListener("click",event=>{stepStoryview(event,"next")})}),window.addEventListener("resize",setSizes),window.addEventListener("keydown",e=>{"Escape"===e.code||"escape"===e.code?ffStoryviewBody.classList.contains("ff_storyview_visible")&&(ffStoryviewBody.classList.remove("ff_storyview_visible"),history.pushState("storyview",document.title,window.location.href.split("#")[0])):"ArrowLeft"===e.code||"arowleft"===e.code?ffStoryviewBody.classList.contains("ff_storyview_visible")&&stepStoryview(null,"previous"):"ArrowRight"!==e.code&&"arowright"!==e.code||ffStoryviewBody.classList.contains("ff_storyview_visible")&&stepStoryview(null,"next")}),window.location.hash.includes("#storyview")&&(ffStoryviewBody.classList.add("ff_storyview_visible"),history.pushState("storyview",document.title+" Storyview","#storyview"));class TinyGesture{constructor(element,options){options=Object.assign({},TinyGesture.defaults,options),this.element=element,this.opts=options,this.touchStartX=null,this.touchStartY=null,this.touchEndX=null,this.touchEndY=null,this.velocityX=null,this.velocityY=null,this.longPressTimer=null,this.doubleTapWaiting=!1,this.handlers={panstart:[],panmove:[],panend:[],swipeleft:[],swiperight:[],swipeup:[],swipedown:[],tap:[],doubletap:[],longpress:[]},this._onTouchStart=this.onTouchStart.bind(this),this._onTouchMove=this.onTouchMove.bind(this),this._onTouchEnd=this.onTouchEnd.bind(this),this.element.addEventListener("touchstart",this._onTouchStart,passiveIfSupported),this.element.addEventListener("touchmove",this._onTouchMove,passiveIfSupported),this.element.addEventListener("touchend",this._onTouchEnd,passiveIfSupported),!this.opts.mouseSupport||"ontouchstart"in window||(this.element.addEventListener("mousedown",this._onTouchStart,passiveIfSupported),document.addEventListener("mousemove",this._onTouchMove,passiveIfSupported),document.addEventListener("mouseup",this._onTouchEnd,passiveIfSupported))}destroy(){this.element.removeEventListener("touchstart",this._onTouchStart),this.element.removeEventListener("touchmove",this._onTouchMove),this.element.removeEventListener("touchend",this._onTouchEnd),this.element.removeEventListener("mousedown",this._onTouchStart),document.removeEventListener("mousemove",this._onTouchMove),document.removeEventListener("mouseup",this._onTouchEnd),clearTimeout(this.longPressTimer),clearTimeout(this.doubleTapTimer)}on(type,fn){if(this.handlers[type])return this.handlers[type].push(fn),{type:type,fn:fn,cancel:()=>this.off(type,fn)}}off(type,fn){if(this.handlers[type]){const idx=this.handlers[type].indexOf(fn);-1!==idx&&this.handlers[type].splice(idx,1)}}fire(type,event){for(let i=0;i<this.handlers[type].length;i++)this.handlers[type][i](event)}onTouchStart(event){this.thresholdX=this.opts.threshold("x",this),this.thresholdY=this.opts.threshold("y",this),this.disregardVelocityThresholdX=this.opts.disregardVelocityThreshold("x",this),this.disregardVelocityThresholdY=this.opts.disregardVelocityThreshold("y",this),this.touchStartX="mousedown"===event.type?event.screenX:event.changedTouches[0].screenX,this.touchStartY="mousedown"===event.type?event.screenY:event.changedTouches[0].screenY,this.touchMoveX=null,this.touchMoveY=null,this.touchEndX=null,this.touchEndY=null,this.longPressTimer=setTimeout(()=>this.fire("longpress",event),this.opts.longPressTime),this.fire("panstart",event)}onTouchMove(event){if("mousemove"===event.type&&(!this.touchStartX||null!==this.touchEndX))return;const touchMoveX=("mousemove"===event.type?event.screenX:event.changedTouches[0].screenX)-this.touchStartX;this.velocityX=touchMoveX-this.touchMoveX,this.touchMoveX=touchMoveX;const touchMoveY=("mousemove"===event.type?event.screenY:event.changedTouches[0].screenY)-this.touchStartY;this.velocityY=touchMoveY-this.touchMoveY,this.touchMoveY=touchMoveY;const absTouchMoveX=Math.abs(this.touchMoveX),absTouchMoveY=Math.abs(this.touchMoveY);this.swipingHorizontal=absTouchMoveX>this.thresholdX,this.swipingVertical=absTouchMoveY>this.thresholdY,this.swipingDirection=absTouchMoveX>absTouchMoveY?this.swipingHorizontal?"horizontal":"pre-horizontal":this.swipingVertical?"vertical":"pre-vertical",Math.max(absTouchMoveX,absTouchMoveY)>this.opts.pressThreshold&&clearTimeout(this.longPressTimer),this.fire("panmove",event)}onTouchEnd(event){if("mouseup"===event.type&&(!this.touchStartX||null!==this.touchEndX))return;this.touchEndX="mouseup"===event.type?event.screenX:event.changedTouches[0].screenX,this.touchEndY="mouseup"===event.type?event.screenY:event.changedTouches[0].screenY,this.fire("panend",event),clearTimeout(this.longPressTimer);const x=this.touchEndX-this.touchStartX,absX=Math.abs(x),y=this.touchEndY-this.touchStartY,absY=Math.abs(y);(absX>this.thresholdX||absY>this.thresholdY)&&(this.swipedHorizontal=this.opts.diagonalSwipes?Math.abs(x/y)<=this.opts.diagonalLimit:absX>=absY&&absX>this.thresholdX,this.swipedVertical=this.opts.diagonalSwipes?Math.abs(y/x)<=this.opts.diagonalLimit:absY>absX&&absY>this.thresholdY,this.swipedHorizontal&&(x<0?(this.velocityX<-this.opts.velocityThreshold||x<-this.disregardVelocityThresholdX)&&this.fire("swipeleft",event):(this.velocityX>this.opts.velocityThreshold||x>this.disregardVelocityThresholdX)&&this.fire("swiperight",event)))}}TinyGesture.defaults={threshold:(type,self)=>Math.max(25,Math.floor(.15*("x"===type?window.innerWidth||document.body.clientWidth:window.innerHeight||document.body.clientHeight))),velocityThreshold:10,disregardVelocityThreshold:(type,self)=>Math.floor(.5*("x"===type?self.element.clientWidth:self.element.clientHeight)),pressThreshold:8,diagonalSwipes:!1,diagonalLimit:Math.tan(.375*Math.PI),longPressTime:500,doubleTapTime:300,mouseSupport:!0};let passiveIfSupported=!1;try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:function(){passiveIfSupported={passive:!0}}}))}catch(err){}const touchOptions={velocityThreshold:5,mouseSupport:!1,disregardVelocityThreshold:(type,self)=>Math.floor(.1*("x"===type?self.element.clientWidth:self.element.clientHeight))},target=document.getElementById("ff_storyview_blocks"),gesture=new TinyGesture(target,touchOptions);("ontouchstart"in window||window.DocumentTouch&&window.document instanceof DocumentTouch||window.navigator.maxTouchPoints||window.navigator.msMaxTouchPoints)&&(gesture.on("swiperight",event=>{stepStoryview(null,"previous")}),gesture.on("swipeleft",event=>{stepStoryview(null,"next")}));