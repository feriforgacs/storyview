jQuery(document).ready(function($){function customSelect(){$(".custom-select").selectric({optionsItemBuilder:function(itemData){return itemData.value.length?'<span class="'+itemData.value+'">'+itemData.text+"</span>":itemData.text},onChange:function(element){let blockId=$(element).data("blockid"),selectedOption=$(element).val();element.classList.contains("font-family-select")?"ampcover"==blockId?setAmpTextFontFamily(selectedOption):setTextFontFamily(blockId,selectedOption):element.classList.contains("font-size-select")&&("ampcover"==blockId?setAmpTextFontSize(selectedOption):setTextFontSize(blockId,selectedOption))}})}let file_frame;customSelect(),$("#ff_storyview_blocks_list").sortable({handle:".ff_storyview_block_item_move",placeholder:"ui-state-highlight",axis:"y",update:function(event,ui){updateStoryBlockIDs()}});let wp_media_post_id=wp.media.model.settings.post.id,set_to_post_id=wp_media_post_id,blockId=0;function setImage(image_url,blockId){$("#ff_storyview_block_item_"+blockId+" .ff_storyview_block_item_preview .ff_storyview_block_item_content").css({"background-image":"url("+image_url+")"}),displayStoryPreview(blockId)}function setTextContent(blockId){let text=$("#ff_storyview_block_item_text_"+blockId).val();$("#ff_storyview_block_item_"+blockId+" .ff_storyview_block_item_content .block_item_text").text(text),displayStoryPreview(blockId)}function setTextPosition(blockId,position){$("#ff_storyview_block_item_"+blockId+" .ff_storyview_block_item_content").removeClass("ff_storyview_text_block_top ff_storyview_text_block_middle ff_storyview_text_block_bottom").addClass(position)}function setTextAlignment(blockId,alignment){$("#ff_storyview_block_item_"+blockId+" .ff_storyview_block_item_content").removeClass("ff_storyview_text_align_left ff_storyview_text_align_center ff_storyview_text_align_right").addClass(alignment)}function setTextBackgroundColor(blockId,backgroundColor){$("#ff_storyview_block_item_"+blockId+" .ff_storyview_block_item_content .block_item_text").removeClass("ff_storyview_block_background_black ff_storyview_block_background_gray ff_storyview_block_background_red ff_storyview_block_background_white ff_storyview_block_background_transparent").addClass(backgroundColor)}function setTextColor(blockId,fontColor){$("#ff_storyview_block_item_"+blockId+" .ff_storyview_block_item_content .block_item_text").removeClass("ff_storyview_block_color_black ff_storyview_block_color_gray ff_storyview_block_color_red ff_storyview_block_color_white").addClass(fontColor)}function setTextFontFamily(blockId,fontFamilyClass){$("#ff_storyview_block_item_"+blockId+" .ff_storyview_block_item_content .block_item_text").removeClass("arial courier roboto rounded montserrat lily").addClass(fontFamilyClass)}function setTextFontSize(blockId,fontSizeClass){$("#ff_storyview_block_item_"+blockId+" .ff_storyview_block_item_content .block_item_text").removeClass("f12 f14 f18 f24 f36").addClass(fontSizeClass)}function setBlockBackgroundColor(blockId,backgroundColorClass){$("#ff_storyview_block_item_"+blockId+" .ff_storyview_block_item_preview_code .ff_storyview_block_item_content").removeClass("ff_storyview_block_background_black ff_storyview_block_background_gray ff_storyview_block_background_red ff_storyview_block_background_white").addClass(backgroundColorClass)}function displayStoryPreview(blockId){$("#ff_storyview_block_item_"+blockId+" .ff_storyview_block_item_preview .preview_text").hide(),$("#ff_storyview_block_item_"+blockId+" .ff_storyview_block_item_preview .ff_storyview_block_item_content").css({display:"flex"}),updateButtonImage()}function deleteStoryBlock(blockId){$("#ff_storyview_block_item_"+blockId).remove(),updateStoryBlockIDs()}function addStoryBlockItem(){let storyBlockItems=$(".ff_storyview_block_item").length;storyBlockItems+=1;let storyBlockTemplate,newStoryBlockItem=$("#storyview_block_template").html().replace(/%BLOCKID%/gi,storyBlockItems);$(newStoryBlockItem).appendTo("#ff_storyview_blocks_list"),customSelect(),updateStoryBlockIDs()}function addStoryCodeBlockItem(){let storyBlockItems=$(".ff_storyview_block_item").length;storyBlockItems+=1;let storyBlockTemplate,newStoryBlockItem=$("#storyview_block_code_template").html().replace(/%BLOCKID%/gi,storyBlockItems);$(newStoryBlockItem).appendTo("#ff_storyview_blocks_list"),updateStoryBlockIDs()}$("#ff_storyview_blocks_list").on("click",".ff_storyview_image_upload",function(event){if(event.preventDefault(),blockId=$(this).data("blockid"),file_frame)return file_frame.uploader.uploader.param("post_id",set_to_post_id),void file_frame.open();wp.media.model.settings.post.id=set_to_post_id,(file_frame=wp.media.frames.file_frame=wp.media({title:"Select image",button:{text:"Use this image"},multiple:!1})).on("select",function(){attachment=file_frame.state().get("selection").first().toJSON(),wp.media.model.settings.post.id=wp_media_post_id,$("#ff_storyview_block_image_"+blockId).val(attachment.url),setImage(attachment.url,blockId)}),file_frame.open()}),$("a.add_media").on("click",function(){wp.media.model.settings.post.id=wp_media_post_id}),$("#ff_storyview_blocks_list").on("keyup",".ff_storyview_block_item_text_textarea",function(){setTextContent($(this).data("blockid"))}),$("#ff_storyview_blocks_list").on("keyup",".ff_storyview_block_content_editor",function(){let blockId=$(this).data("blockid"),codeBlockValue=$(this).val();$("#ff_storyview_block_item_"+blockId+" .ff_storyview_block_item_content").html(codeBlockValue).css({display:"flex"}),$("#ff_storyview_block_item_"+blockId+" .preview_text").css({display:"none"})}),$("#ff_storyview_blocks_list").on("click",".ff_storyview_block_item_text_position_label",function(){let positionValue=$(this).children("input[type=radio]").val(),blockId=$(this).data("blockid");$('.ff_storyview_block_item_text_position_label.activ[data-blockid="'+blockId+'"]').removeClass("activ"),$(this).addClass("activ"),setTextPosition(blockId,positionValue)}),$("#ff_storyview_blocks_list").on("click",".ff_storyview_block_item_text_align_label",function(){let alignmentValue=$(this).children("input[type=radio]").val(),blockId=$(this).data("blockid");$('.ff_storyview_block_item_text_align_label.activ[data-blockid="'+blockId+'"]').removeClass("activ"),$(this).addClass("activ"),setTextAlignment(blockId,alignmentValue)}),$("#ff_storyview_blocks_list").on("click",".ff_storyview_block_item_text_background_color_label",function(){let backgroundColorValue=$(this).children("input[type=radio]").val(),blockId=$(this).data("blockid");$('.ff_storyview_block_item_text_background_color_label[data-blockid="'+blockId+'"] .activ').removeClass("activ"),$(this).children(".color-preview").addClass("activ"),setTextBackgroundColor(blockId,backgroundColorValue)}),$("#ff_storyview_blocks_list").on("click",".ff_storyview_block_item_text_font_color_label",function(){let fontColorValue=$(this).children("input[type=radio]").val(),blockId=$(this).data("blockid");$('.ff_storyview_block_item_text_font_color_label[data-blockid="'+blockId+'"] .activ').removeClass("activ"),$(this).children(".color-preview").addClass("activ"),setTextColor(blockId,fontColorValue)}),$("#ff_storyview_blocks_list").on("click",".ff_storyview_block_item_background_color_label",function(){let backgroundColorValue=$(this).children("input[type=radio]").val(),blockId=$(this).data("blockid");$('.ff_storyview_block_item_background_color_label[data-blockid="'+blockId+'"] .activ').removeClass("activ"),$(this).children(".color-preview").addClass("activ"),setBlockBackgroundColor(blockId,backgroundColorValue)}),$("#ff_storyview_blocks_list").on("click",".ff_storyview_block_delete_button",function(){let blockId=$(this).data("blockid");confirm("Are you sure you want to remove the selected story block?")&&deleteStoryBlock(blockId)}),$("#ff_storyview_add_block_button").on("click",addStoryBlockItem),$("#ff_storyview_add_code_block_button").on("click",addStoryCodeBlockItem);const storyViewBasicSettings=$("#ff_storyview_basic_settings"),storyViewBlocks=$("#ff_storyview_blocks"),addBlockButton=$(".ff_storyview_add_actions");$("#ff_storyview_activ").on("change",function(){$(this).is(":checked")?(storyViewBasicSettings.show(),storyViewBlocks.show(),addBlockButton.css({display:"flex"})):(storyViewBasicSettings.hide(),storyViewBlocks.hide(),addBlockButton.hide())});const storyBlockIDs=$("#story_block_ids");function updateStoryBlockIDs(){let storyBlockIds="";$("#ff_storyview_blocks_list .ff_storyview_block_item").each(function(){let blockId=$(this).data("blockid");storyBlockIds+=blockId+","}),storyBlockIDs.val(storyBlockIds),updateButtonImage()}function getHighestStoryID(){let highestId=1;return $("#ff_storyview_blocks_list .ff_storyview_block_item").each(function(){$(this).data("blockid")>highestId&&(highestId=$(this).data("blockid"))}),highestId}function updateButtonImage(){if($(".ff_storyview_block_item").length){let image=$(".ff_storyview_block_item_classic:first").first().find(".ff_storyview_block_item_content").css("background-image");$(".ff_storyview_button .ff_storyview_button_icon").each(function(){$(this).css({"background-image":image})})}else $(".ff_storyview_button .ff_storyview_button_icon").each(function(){$(this).css({"background-image":"none"})})}function setAmpTextBackgroundColor(backgroundColor){$("#ff_storyview_amp_story_settings .ff_storyview_amp_cover_content .block_item_text").removeClass("ff_storyview_block_background_black ff_storyview_block_background_gray ff_storyview_block_background_red ff_storyview_block_background_white ff_storyview_block_background_transparent").addClass(backgroundColor)}function setAmpTextColor(fontColor){$("#ff_storyview_amp_story_settings .ff_storyview_amp_cover_content .block_item_text").removeClass("ff_storyview_block_color_black ff_storyview_block_color_gray ff_storyview_block_color_red ff_storyview_block_color_white").addClass(fontColor)}function setAmpTextPosition(position){$("#ff_storyview_amp_story_settings .ff_storyview_amp_cover_content").removeClass("ff_storyview_text_block_top ff_storyview_text_block_middle ff_storyview_text_block_bottom").addClass(position)}function setAmpTextAlignment(alignment){$("#ff_storyview_amp_story_settings .ff_storyview_amp_cover_content").removeClass("ff_storyview_text_align_left ff_storyview_text_align_center ff_storyview_text_align_right").addClass(alignment)}function setAmpTextFontFamily(fontFamilyClass){$("#ff_storyview_amp_story_settings .ff_storyview_amp_cover_content .block_item_text").removeClass("arial courier roboto rounded montserrat lily").addClass(fontFamilyClass)}function setAmpTextFontSize(fontSizeClass){$("#ff_storyview_amp_story_settings .ff_storyview_amp_cover_content .block_item_text").removeClass("f12 f14 f18 f24 f36").addClass(fontSizeClass)}let file_frame_amp_cover,file_frame_amp_publisher_logo;function setAmpCoverImage(image_url){console.log("itt vagyok - setAmpCoverImage"),$("#ff_storyview_amp_story_settings .ff_storyview_amp_cover_preview .ff_storyview_amp_cover_content").css({"background-image":"url("+image_url+")"}),displayAmpCoverPreview()}function displayAmpCoverPreview(){console.log("itt vagyok - displayAmpCoverPreview"),$("#ff_storyview_amp_story_settings .ff_storyview_amp_cover_preview .preview_text").hide(),$("#ff_storyview_amp_story_settings .ff_storyview_amp_cover_preview .ff_storyview_amp_cover_content").css({display:"flex"})}function setAmpPublisherImage(image_url){console.log("itt vagyok - setAmpPublisherImage"),$("#ff_storyview_amp_publisher_logo_preview").html(`<img src="${image_url}" />`)}$("#ff_storyview_button_text").on("keyup",function(){let buttonText=$(this).val();$(".ff_storyview_button .ff_storyview_button_text").each(function(){$(this).text(buttonText)})}),updateButtonImage(),$("input.ff_storyview_button_type").on("change",function(){$("#ff_storyview_button_type_other").is(":checked")?$("#ff_storyview_button_types_other").show():$("#ff_storyview_button_types_other").hide()}),$("#ff_storyview_amp_story_settings").on("click",".ff_storyview_amp_cover_text_background_color_label",function(){let backgroundColorValue=$(this).children("input[type=radio]").val();$("#ff_storyview_amp_story_settings .ff_storyview_amp_cover_text_background_color_label .activ").removeClass("activ"),$(this).children(".color-preview").addClass("activ"),setAmpTextBackgroundColor(backgroundColorValue)}),$("#ff_storyview_amp_story_settings").on("click",".ff_storyview_amp_cover_text_font_color_label",function(){let textColorValue=$(this).children("input[type=radio]").val();$("#ff_storyview_amp_story_settings .ff_storyview_amp_cover_text_font_color_label .activ").removeClass("activ"),$(this).children(".color-preview").addClass("activ"),setAmpTextColor(textColorValue)}),$("#ff_storyview_amp_story_settings").on("click",".ff_storyview_amp_cover_text_position_label",function(){let positionValue=$(this).children("input[type=radio]").val();$(".ff_storyview_amp_cover_text_position_label.activ").removeClass("activ"),$(this).addClass("activ"),setAmpTextPosition(positionValue)}),$("#ff_storyview_amp_story_settings").on("click",".ff_storyview_amp_cover_text_align_label",function(){let alignmentValue=$(this).children("input[type=radio]").val();$(".ff_storyview_amp_cover_text_align_label.activ").removeClass("activ"),$(this).addClass("activ"),setAmpTextAlignment(alignmentValue)}),$("#ff_storyview_amp_story_settings").on("click",".ff_storyview_amp_cover_upload",function(event){if(console.log("itt vagyok - Cover upload"),event.preventDefault(),file_frame_amp_cover)return file_frame_amp_cover.uploader.uploader.param("post_id",set_to_post_id),void file_frame_amp_cover.open();wp.media.model.settings.post.id=set_to_post_id,(file_frame_amp_cover=wp.media.frames.file_frame_amp_cover=wp.media({title:"Select image",button:{text:"Use this image"},multiple:!1})).on("select",function(){attachment=file_frame_amp_cover.state().get("selection").first().toJSON(),wp.media.model.settings.post.id=wp_media_post_id,$("#ff_storyview_amp_cover_image").val(attachment.url),setAmpCoverImage(attachment.url)}),file_frame_amp_cover.open()}),$("#ff_storyview_amp_publisher_logo_upload").on("click",function(event){if(console.log("itt vagyok - ff_storyview_amp_publisher_logo_upload"),event.preventDefault(),file_frame_amp_publisher_logo)return file_frame_amp_publisher_logo.uploader.uploader.param("post_id",set_to_post_id),void file_frame_amp_publisher_logo.open();wp.media.model.settings.post.id=set_to_post_id,(file_frame_amp_publisher_logo=wp.media.frames.file_frame_amp_publisher_logo=wp.media({title:"Select image",button:{text:"Use this image"},multiple:!1})).on("select",function(){attachment=file_frame_amp_publisher_logo.state().get("selection").first().toJSON(),wp.media.model.settings.post.id=wp_media_post_id,$("#ff_storyview_amp_publisher_logo_image").val(attachment.url),setAmpPublisherImage(attachment.url)}),file_frame_amp_publisher_logo.open()})});