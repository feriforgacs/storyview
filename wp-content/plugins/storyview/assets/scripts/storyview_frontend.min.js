const ffStoryviewGap=40,ffStoryviewCodeBlockBottomGap=60,ffStoryviewEndScreenBottomGap=60,ffStoryviewControllerBlockBottomGap=60;let ffStoryviewCurrentStory=0;const ffStoryviewBody=document.querySelector("body"),ffStoryviewDisplayButton=document.querySelectorAll(".ff_storyview_button"),ffStoryviewCloseButton=document.querySelectorAll(".ff_storyview_close_button");let ffStoryviewBlockWidth=window.innerWidth<420?window.innerWidth:420,ffStoryviewBlockHeight=window.innerHeight<746?window.innerHeight:746;const toggleStoryview=e=>{if(e.preventDefault(),e.target.classList.contains("ff_storyview_close_button"))document.querySelectorAll(".ff_storyview_blocks_container").forEach(storyviewBlockContainer=>{storyviewBlockContainer.classList.remove("visible")}),ffStoryviewBody.classList.remove("ff_storyview_visible"),history.pushState("storyview",document.title,window.location.href.split("#")[0]),ffToggleSharePanel();else{let currentStoryviewBlock;ffStoryviewBody.classList.add("ff_storyview_visible"),currentStoryviewBlock=this.nextSibling&&this.nextSibling.classList.contains("ff_storyview_blocks_container")?this.nextSibling:findClosestStoryviewBlock(e.target),currentStoryviewBlock.classList.add("visible"),ffStoryviewCurrentStory=currentStoryviewBlock.querySelector(".ff_storyview_block_indicator_item.activ").dataset.index,history.pushState("storyview",document.title+" Storyview","#storyview")}setSizes()},findClosestStoryviewBlock=elem=>{for(;elem&&elem!==document;elem=elem.parentNode){if(elem.classList.contains("ff_storyview_blocks_container"))return elem;if(elem.nextSibling&&elem.nextSibling.classList.contains("ff_storyview_blocks_container"))return elem.nextSibling;elem.nextSibling&&elem.nextSibling.hasChildNodes()&&elem.childNodes.forEach(child=>{if(child.classList.contains("ff_storyview_blocks_container"))return child})}return null},setSizes=()=>{const ffStoryviewBlocks=document.querySelectorAll(".ff_storyview_blocks");ffStoryviewBlocks&&ffStoryviewBlocks.forEach(storyviewBlock=>{let ffStoryviewBlocksContainer=storyviewBlock.querySelectorAll(".ff_storyview_blocks_items_container"),ffStoryviewBlockItems=storyviewBlock.querySelectorAll(".ff_storyview_block_item_content"),ffStoryviewBlockCodeItems=storyviewBlock.querySelectorAll(".ff_storyview_block_item_content_code"),ffStoryviewBlockEndScreen=storyviewBlock.querySelectorAll(".ff_storyview_block_item_content_end_screen"),ffStoryviewBlockItemsCount=ffStoryviewBlockItems.length+ffStoryviewBlockCodeItems.length+ffStoryviewBlockEndScreen.length;ffStoryviewBlockWidth=window.innerWidth<420?window.innerWidth:420,ffStoryviewBlockHeight=window.innerHeight<746?window.innerHeight:746;let width=ffStoryviewBlockWidth*ffStoryviewBlockItemsCount;ffStoryviewBlocksContainer.forEach(storyviewBlockContainer=>{storyviewBlockContainer.style.width=width+"px"}),ffStoryviewBlockItems.forEach(ffStoryviewBlockItem=>{ffStoryviewBlockItem.style.width=ffStoryviewBlockWidth+"px";let blockHeight=ffStoryviewBlockHeight-40;ffStoryviewBlockItem.classList.contains("controllers_visible")&&(blockHeight-=60),ffStoryviewBlockItem.style.height=blockHeight+"px"}),ffStoryviewBlockCodeItems.forEach(ffStoryviewBlockItem=>{ffStoryviewBlockItem.style.width=ffStoryviewBlockWidth+"px";let blockHeight=ffStoryviewBlockHeight-40;ffStoryviewBlockItem.style.height=blockHeight+"px";let codeBlock,codeBlockHeight=blockHeight-60;ffStoryviewBlockItem.querySelector(".ff_storyview_block_item_code").style.height=codeBlockHeight+"px"}),ffStoryviewBlockEndScreen.forEach(ffStoryviewBlockItem=>{ffStoryviewBlockItem.style.width=ffStoryviewBlockWidth+"px";let blockHeight=ffStoryviewBlockHeight-40;ffStoryviewBlockItem.style.height=blockHeight+"px";let endScreen,endScreenHeight=blockHeight-60;ffStoryviewBlockItem.querySelector(".ff_storyview_block_item_end_screen").style.height=endScreenHeight+"px"})})},stepStoryview=(event=null,direction=null)=>{if(event&&event.target.closest(".ff_storyview_block_item_content_code")&&!direction)return;if(event&&event.target.classList.contains("ff_storyview_close_button"))return;if(event&&event.target.classList.contains("storyview_share_section_item"))return;if(event&&event.target.classList.contains("end_screen"))return;const currentStoryviewBlock=document.querySelector(".ff_storyview_blocks_container.visible"),currentStoryviewBlockContainer=currentStoryviewBlock.querySelector(".ff_storyview_blocks_items_container"),currentStoryviewBlockItemsCount=currentStoryviewBlockContainer.querySelectorAll(".item").length;let ffStoryviewBlocksPosition=currentStoryviewBlock.getBoundingClientRect(),ffStoryviewBlocksLeftMax=ffStoryviewBlocksPosition.left+ffStoryviewBlocksPosition.width/2;if(event&&event.clientX>ffStoryviewBlocksLeftMax||"next"==direction){if(ffStoryviewCurrentStory<currentStoryviewBlockItemsCount-1){let left=(ffStoryviewCurrentStory+1)*ffStoryviewBlockWidth;currentStoryviewBlockContainer.style.transform="translateX(-"+left+"px)",ffStoryviewCurrentStory++}updateIndicator("next",currentStoryviewBlock)}else{if(ffStoryviewCurrentStory>0){let left=ffStoryviewCurrentStory*ffStoryviewBlockWidth-ffStoryviewBlockWidth;currentStoryviewBlockContainer.style.transform="translateX(-"+left+"px)",ffStoryviewCurrentStory--}updateIndicator("previous",currentStoryviewBlock)}},updateIndicator=(direction,storyviewBlock)=>{if("next"==direction){let previousStoryIndicator=ffStoryviewCurrentStory-1;storyviewBlock.querySelector(".ff_storyview_block_indicator_item_"+previousStoryIndicator)&&(storyviewBlock.querySelector(".ff_storyview_block_indicator_item_"+previousStoryIndicator).classList.remove("activ"),storyviewBlock.querySelector(".ff_storyview_block_indicator_item_"+ffStoryviewCurrentStory).classList.add("activ"))}else if("previous"==direction){let nextStoryIndicator=ffStoryviewCurrentStory+1;storyviewBlock.querySelector(".ff_storyview_block_indicator_item_"+nextStoryIndicator)&&(storyviewBlock.querySelector(".ff_storyview_block_indicator_item_"+nextStoryIndicator).classList.remove("activ"),storyviewBlock.querySelector(".ff_storyview_block_indicator_item_"+ffStoryviewCurrentStory).classList.add("activ"))}};setSizes(),window.addEventListener("resize",setSizes);const ffToggleSharePanel=(action="")=>{ffStoryviewBody.classList.contains("ff_storyview_share_panel_visible")||"hide"===action?ffStoryviewBody.classList.remove("ff_storyview_share_panel_visible"):ffStoryviewBody.classList.add("ff_storyview_share_panel_visible")},ffShareStoryURL=event=>{event.preventDefault();const shareURL=event.target.closest("a").getAttribute("href"),storyID=event.target.closest("a").dataset.story;copyToClipboard(shareURL);const copyURLsuccessMessage=document.querySelector(`#storyview_share_panel_link_copied_${storyID}`);copyURLsuccessMessage.style.display="block",setTimeout(()=>{copyURLsuccessMessage.style.display="none"},1e3)},copyToClipboard=text=>{const textarea=document.createElement("textarea");textarea.value=text,document.body.appendChild(textarea),textarea.select(),document.execCommand("copy"),document.body.removeChild(textarea)},ffStoryviewWidgetDisplayStory=e=>{e.preventDefault();const ffStoryviewWidgetStoryID=e.target.dataset.story;let ffStoryviewButton=document.getElementById(`ff_storyview_button_${ffStoryviewWidgetStoryID}`);if(ffStoryviewButton)return void ffStoryviewButton.click();const storyThumbnail=document.getElementById(`ff_storyview_widget_story_item_thumbnail_${ffStoryviewWidgetStoryID}`);storyThumbnail.classList.add("loading"),e.target.classList.add("loading"),fetch(ffStoryviewAjaxURL,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=utf-8"},body:`action=storyview_ajax_frontend_action&storyviewAction=display&storyID=${ffStoryviewWidgetStoryID}`,credentials:"same-origin"}).then(response=>response.json()).then(data=>{if(storyThumbnail.classList.remove("loading"),e.target.classList.remove("loading"),data.story){let ffStoryviewStoryRoot=document.getElementById("ff_storyview_root");ffStoryviewStoryRoot||(ffStoryviewStoryRoot=document.createElement("div"),ffStoryviewStoryRoot.id="ff_storyview_root",document.getElementsByTagName("body")[0].appendChild(ffStoryviewStoryRoot)),ffStoryviewStoryRoot.innerHTML=data.story,ffStoryviewButton=document.getElementById(`ff_storyview_button_${ffStoryviewWidgetStoryID}`),ffStoryviewButton.click()}else alert("There was an error during the process. Please, refresh the page and try again")})};if(ffStoryviewBody.addEventListener("click",event=>{if(event.target.closest(".ff_storyview_button")&&toggleStoryview(event),event.target.closest(".ff_storyview_close_button")&&toggleStoryview(event),event.target.closest(".ff_storyview_blocks")&&stepStoryview(event),event.target.closest(".code_block_previous")&&stepStoryview(event,"previous"),event.target.closest(".code_block_next")&&stepStoryview(event,"next"),event.target.closest(".storyview_share_button")&&ffToggleSharePanel(),event.target.closest(".storyview_share_panel_container")){let ffStoryviewShareStoryID=event.target.closest(".storyview_share_panel_container").dataset.story,ffStoryViewSharePanel;document.getElementById(`storyview_share_panel_${ffStoryviewShareStoryID}`).contains(event.target)||ffToggleSharePanel()}event.target.closest(".storyview_share_option_link")&&ffShareStoryURL(event),event.target.closest(".ff_storyview_end_screen_share_button")&&ffToggleSharePanel(),event.target.closest(".ff_storyview_widget_story_item")&&ffStoryviewWidgetDisplayStory(event)}),window.addEventListener("keydown",e=>{"Escape"===e.code||"escape"===e.code?ffStoryviewBody.classList.contains("ff_storyview_visible")&&(ffStoryviewBody.classList.remove("ff_storyview_visible"),document.querySelectorAll(".ff_storyview_blocks_container").forEach(storyviewBlockContainer=>{storyviewBlockContainer.classList.remove("visible")}),history.pushState("storyview",document.title,window.location.href.split("#")[0]),ffToggleSharePanel("hide")):"ArrowLeft"===e.code||"arowleft"===e.code?ffStoryviewBody.classList.contains("ff_storyview_visible")&&stepStoryview(null,"previous"):"ArrowRight"!==e.code&&"arowright"!==e.code||ffStoryviewBody.classList.contains("ff_storyview_visible")&&stepStoryview(null,"next")}),window.location.hash.includes("#storyview")){let ffStoryViewButtons=document.querySelectorAll(".ff_storyview_button");ffStoryViewButtons.length>0&&(ffStoryviewBody.classList.add("ff_storyview_visible"),history.pushState("storyview",document.title+" Storyview","#storyview"),ffStoryViewButtons[0].click())}class TinyGesture{constructor(element,options){options=Object.assign({},TinyGesture.defaults,options),this.element=element,this.opts=options,this.touchStartX=null,this.touchStartY=null,this.touchEndX=null,this.touchEndY=null,this.velocityX=null,this.velocityY=null,this.longPressTimer=null,this.doubleTapWaiting=!1,this.handlers={panstart:[],panmove:[],panend:[],swipeleft:[],swiperight:[],swipeup:[],swipedown:[],tap:[],doubletap:[],longpress:[]},this._onTouchStart=this.onTouchStart.bind(this),this._onTouchMove=this.onTouchMove.bind(this),this._onTouchEnd=this.onTouchEnd.bind(this),this.element.addEventListener("touchstart",this._onTouchStart,passiveIfSupported),this.element.addEventListener("touchmove",this._onTouchMove,passiveIfSupported),this.element.addEventListener("touchend",this._onTouchEnd,passiveIfSupported),!this.opts.mouseSupport||"ontouchstart"in window||(this.element.addEventListener("mousedown",this._onTouchStart,passiveIfSupported),document.addEventListener("mousemove",this._onTouchMove,passiveIfSupported),document.addEventListener("mouseup",this._onTouchEnd,passiveIfSupported))}destroy(){this.element.removeEventListener("touchstart",this._onTouchStart),this.element.removeEventListener("touchmove",this._onTouchMove),this.element.removeEventListener("touchend",this._onTouchEnd),this.element.removeEventListener("mousedown",this._onTouchStart),document.removeEventListener("mousemove",this._onTouchMove),document.removeEventListener("mouseup",this._onTouchEnd),clearTimeout(this.longPressTimer),clearTimeout(this.doubleTapTimer)}on(type,fn){if(this.handlers[type])return this.handlers[type].push(fn),{type:type,fn:fn,cancel:()=>this.off(type,fn)}}off(type,fn){if(this.handlers[type]){const idx=this.handlers[type].indexOf(fn);-1!==idx&&this.handlers[type].splice(idx,1)}}fire(type,event){for(let i=0;i<this.handlers[type].length;i++)this.handlers[type][i](event)}onTouchStart(event){this.thresholdX=this.opts.threshold("x",this),this.thresholdY=this.opts.threshold("y",this),this.disregardVelocityThresholdX=this.opts.disregardVelocityThreshold("x",this),this.disregardVelocityThresholdY=this.opts.disregardVelocityThreshold("y",this),this.touchStartX="mousedown"===event.type?event.screenX:event.changedTouches[0].screenX,this.touchStartY="mousedown"===event.type?event.screenY:event.changedTouches[0].screenY,this.touchMoveX=null,this.touchMoveY=null,this.touchEndX=null,this.touchEndY=null,this.longPressTimer=setTimeout(()=>this.fire("longpress",event),this.opts.longPressTime),this.fire("panstart",event)}onTouchMove(event){if("mousemove"===event.type&&(!this.touchStartX||null!==this.touchEndX))return;const touchMoveX=("mousemove"===event.type?event.screenX:event.changedTouches[0].screenX)-this.touchStartX;this.velocityX=touchMoveX-this.touchMoveX,this.touchMoveX=touchMoveX;const touchMoveY=("mousemove"===event.type?event.screenY:event.changedTouches[0].screenY)-this.touchStartY;this.velocityY=touchMoveY-this.touchMoveY,this.touchMoveY=touchMoveY;const absTouchMoveX=Math.abs(this.touchMoveX),absTouchMoveY=Math.abs(this.touchMoveY);this.swipingHorizontal=absTouchMoveX>this.thresholdX,this.swipingVertical=absTouchMoveY>this.thresholdY,this.swipingDirection=absTouchMoveX>absTouchMoveY?this.swipingHorizontal?"horizontal":"pre-horizontal":this.swipingVertical?"vertical":"pre-vertical",Math.max(absTouchMoveX,absTouchMoveY)>this.opts.pressThreshold&&clearTimeout(this.longPressTimer),this.fire("panmove",event)}onTouchEnd(event){if("mouseup"===event.type&&(!this.touchStartX||null!==this.touchEndX))return;this.touchEndX="mouseup"===event.type?event.screenX:event.changedTouches[0].screenX,this.touchEndY="mouseup"===event.type?event.screenY:event.changedTouches[0].screenY,this.fire("panend",event),clearTimeout(this.longPressTimer);const x=this.touchEndX-this.touchStartX,absX=Math.abs(x),y=this.touchEndY-this.touchStartY,absY=Math.abs(y);(absX>this.thresholdX||absY>this.thresholdY)&&(this.swipedHorizontal=this.opts.diagonalSwipes?Math.abs(x/y)<=this.opts.diagonalLimit:absX>=absY&&absX>this.thresholdX,this.swipedVertical=this.opts.diagonalSwipes?Math.abs(y/x)<=this.opts.diagonalLimit:absY>absX&&absY>this.thresholdY,this.swipedHorizontal&&(x<0?(this.velocityX<-this.opts.velocityThreshold||x<-this.disregardVelocityThresholdX)&&this.fire("swipeleft",event):(this.velocityX>this.opts.velocityThreshold||x>this.disregardVelocityThresholdX)&&this.fire("swiperight",event)))}}TinyGesture.defaults={threshold:(type,self)=>Math.max(25,Math.floor(.15*("x"===type?window.innerWidth||document.body.clientWidth:window.innerHeight||document.body.clientHeight))),velocityThreshold:10,disregardVelocityThreshold:(type,self)=>Math.floor(.5*("x"===type?self.element.clientWidth:self.element.clientHeight)),pressThreshold:8,diagonalSwipes:!1,diagonalLimit:Math.tan(.375*Math.PI),longPressTime:500,doubleTapTime:300,mouseSupport:!0};let passiveIfSupported=!1;try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:function(){passiveIfSupported={passive:!0}}}))}catch(err){}const touchOptions={velocityThreshold:5,mouseSupport:!1,disregardVelocityThreshold:(type,self)=>Math.floor(.1*("x"===type?self.element.clientWidth:self.element.clientHeight))};let touchTarget=document.querySelectorAll(".ff_storyview_blocks"),gestures=[];touchTarget.forEach(target=>{gestures.push(new TinyGesture(target,touchOptions))}),gestures.forEach(gesture=>{("ontouchstart"in window||window.DocumentTouch&&window.document instanceof DocumentTouch||window.navigator.maxTouchPoints||window.navigator.msMaxTouchPoints)&&(gesture.on("swiperight",event=>{stepStoryview(null,"previous")}),gesture.on("swipeleft",event=>{stepStoryview(null,"next")}))});