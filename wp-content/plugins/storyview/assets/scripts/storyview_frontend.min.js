"use strict";var _this=void 0;function _instanceof(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?!!e[Symbol.hasInstance](t):t instanceof e}function _classCallCheck(t,e){if(!_instanceof(t,e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,o){return e&&_defineProperties(t.prototype,e),o&&_defineProperties(t,o),t}var ffStoryviewGap=40,ffStoryviewCodeBlockBottomGap=60,ffStoryviewEndScreenBottomGap=60,ffStoryviewControllerBlockBottomGap=60,ffStoryviewCurrentStory=0,ffStoryviewBody=document.querySelector("body"),ffStoryviewDisplayButton=document.querySelectorAll(".ff_storyview_button"),ffStoryviewCloseButton=document.querySelectorAll(".ff_storyview_close_button"),ffStoryviewBlockWidth=window.innerWidth<420?window.innerWidth:420,ffStoryviewBlockHeight=window.innerHeight<746?window.innerHeight:746,toggleStoryview=function(t){var e;(t.preventDefault(),t.target.classList.contains("ff_storyview_close_button"))?(document.querySelectorAll(".ff_storyview_blocks_container").forEach(function(t){t.classList.remove("visible")}),ffStoryviewBody.classList.remove("ff_storyview_visible"),history.pushState("storyview",document.title,window.location.href.split("#")[0]),ffToggleSharePanel()):(ffStoryviewBody.classList.add("ff_storyview_visible"),(e=_this.nextSibling&&_this.nextSibling.classList.contains("ff_storyview_blocks_container")?_this.nextSibling:findClosestStoryviewBlock(t.target)).classList.add("visible"),ffStoryviewCurrentStory=e.querySelector(".ff_storyview_block_indicator_item.activ").dataset.index,history.pushState("storyview",document.title+" Storyview","#storyview"));setSizes()},findClosestStoryviewBlock=function(t){for(;t&&t!==document;t=t.parentNode){if(t.classList.contains("ff_storyview_blocks_container"))return t;if(t.nextSibling&&t.nextSibling.classList.contains("ff_storyview_blocks_container"))return t.nextSibling;t.nextSibling&&t.nextSibling.hasChildNodes()&&t.childNodes.forEach(function(t){if(t.classList.contains("ff_storyview_blocks_container"))return t})}return null},setSizes=function(){var t=document.querySelectorAll(".ff_storyview_blocks");t&&t.forEach(function(t){var e=t.querySelectorAll(".ff_storyview_blocks_items_container"),o=t.querySelectorAll(".ff_storyview_block_item_content"),i=t.querySelectorAll(".ff_storyview_block_item_content_code"),s=t.querySelectorAll(".ff_storyview_block_item_content_end_screen"),r=o.length+i.length+s.length;ffStoryviewBlockWidth=window.innerWidth<420?window.innerWidth:420,ffStoryviewBlockHeight=window.innerHeight<746?window.innerHeight:746;var n=ffStoryviewBlockWidth*r;e.forEach(function(t){t.style.width=n+"px"}),o.forEach(function(t){t.style.width=ffStoryviewBlockWidth+"px";var e=ffStoryviewBlockHeight-ffStoryviewGap;t.classList.contains("controllers_visible")&&(e-=ffStoryviewControllerBlockBottomGap),t.style.height=e+"px"}),i.forEach(function(t){t.style.width=ffStoryviewBlockWidth+"px";var e=ffStoryviewBlockHeight-ffStoryviewGap;t.style.height=e+"px";var o=t.querySelector(".ff_storyview_block_item_code"),i=e-ffStoryviewCodeBlockBottomGap;o.style.height=i+"px"}),s.forEach(function(t){t.style.width=ffStoryviewBlockWidth+"px";var e=ffStoryviewBlockHeight-ffStoryviewGap;t.style.height=e+"px";var o=t.querySelector(".ff_storyview_block_item_end_screen"),i=e-ffStoryviewEndScreenBottomGap;o.style.height=i+"px"})})},stepStoryview=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if((!t||!t.target.closest(".ff_storyview_block_item_content_code")||e)&&!(t&&t.target.classList.contains("ff_storyview_close_button")||t&&t.target.classList.contains("storyview_share_section_item")||t&&t.target.classList.contains("end_screen"))){var o=document.querySelector(".ff_storyview_blocks_container.visible"),i=o.querySelector(".ff_storyview_blocks_items_container"),s=i.querySelectorAll(".item").length,r=o.getBoundingClientRect(),n=r.left+r.width/2;if(t&&t.clientX>n||"next"==e){if(ffStoryviewCurrentStory<s-1){var c=(ffStoryviewCurrentStory+1)*ffStoryviewBlockWidth;i.style.transform="translateX(-"+c+"px)",ffStoryviewCurrentStory++}updateIndicator("next",o)}else{if(ffStoryviewCurrentStory>0){var l=ffStoryviewCurrentStory*ffStoryviewBlockWidth-ffStoryviewBlockWidth;i.style.transform="translateX(-"+l+"px)",ffStoryviewCurrentStory--}updateIndicator("previous",o)}}},updateIndicator=function(t,e){if("next"==t){var o=ffStoryviewCurrentStory-1;e.querySelector(".ff_storyview_block_indicator_item_"+o)&&(e.querySelector(".ff_storyview_block_indicator_item_"+o).classList.remove("activ"),e.querySelector(".ff_storyview_block_indicator_item_"+ffStoryviewCurrentStory).classList.add("activ"))}else if("previous"==t){var i=ffStoryviewCurrentStory+1;e.querySelector(".ff_storyview_block_indicator_item_"+i)&&(e.querySelector(".ff_storyview_block_indicator_item_"+i).classList.remove("activ"),e.querySelector(".ff_storyview_block_indicator_item_"+ffStoryviewCurrentStory).classList.add("activ"))}};setSizes(),window.addEventListener("resize",setSizes);var ffToggleSharePanel=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";ffStoryviewBody.classList.contains("ff_storyview_share_panel_visible")||"hide"===t?ffStoryviewBody.classList.remove("ff_storyview_share_panel_visible"):ffStoryviewBody.classList.add("ff_storyview_share_panel_visible")},ffShareStoryURL=function(t){t.preventDefault();var e=t.target.closest("a").getAttribute("href"),o=t.target.closest("a").dataset.story;copyToClipboard(e);var i=document.querySelector("#storyview_share_panel_link_copied_".concat(o));i.style.display="block",setTimeout(function(){i.style.display="none"},1e3)},copyToClipboard=function(t){var e=document.createElement("textarea");e.value=t,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)},ffStoryviewWidgetDisplayStory=function(t){t.preventDefault();var e=t.target.dataset.story,o=document.getElementById("ff_storyview_button_".concat(e));if(o)o.click();else{var i=document.getElementById("ff_storyview_widget_story_item_thumbnail_".concat(e));i.classList.add("loading"),t.target.classList.add("loading"),fetch(ffStoryviewAjaxURL,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=utf-8"},body:"action=storyview_ajax_frontend_action&storyviewAction=display&storyID=".concat(e),credentials:"same-origin"}).then(function(t){return t.json()}).then(function(s){if(i.classList.remove("loading"),t.target.classList.remove("loading"),s.story){var r=document.getElementById("ff_storyview_root");r||((r=document.createElement("div")).id="ff_storyview_root",document.getElementsByTagName("body")[0].appendChild(r)),r.innerHTML=s.story,(o=document.getElementById("ff_storyview_button_".concat(e))).click()}else alert("There was an error during the process. Please, refresh the page and try again")})}};if(ffStoryviewBody.addEventListener("click",function(t){if(t.target.closest(".ff_storyview_button")&&toggleStoryview(t),t.target.closest(".ff_storyview_close_button")&&toggleStoryview(t),t.target.closest(".ff_storyview_blocks")&&stepStoryview(t),t.target.closest(".code_block_previous")&&stepStoryview(t,"previous"),t.target.closest(".code_block_next")&&stepStoryview(t,"next"),t.target.closest(".storyview_share_button")&&ffToggleSharePanel(),t.target.closest(".storyview_share_panel_container")){var e=t.target.closest(".storyview_share_panel_container").dataset.story;document.getElementById("storyview_share_panel_".concat(e)).contains(t.target)||ffToggleSharePanel()}t.target.closest(".storyview_share_option_link")&&ffShareStoryURL(t),t.target.closest(".ff_storyview_end_screen_share_button")&&ffToggleSharePanel(),t.target.closest(".ff_storyview_widget_story_item")&&ffStoryviewWidgetDisplayStory(t)}),window.addEventListener("keydown",function(t){"Escape"===t.code||"escape"===t.code?ffStoryviewBody.classList.contains("ff_storyview_visible")&&(ffStoryviewBody.classList.remove("ff_storyview_visible"),document.querySelectorAll(".ff_storyview_blocks_container").forEach(function(t){t.classList.remove("visible")}),history.pushState("storyview",document.title,window.location.href.split("#")[0]),ffToggleSharePanel("hide")):"ArrowLeft"===t.code||"arowleft"===t.code?ffStoryviewBody.classList.contains("ff_storyview_visible")&&stepStoryview(null,"previous"):"ArrowRight"!==t.code&&"arowright"!==t.code||ffStoryviewBody.classList.contains("ff_storyview_visible")&&stepStoryview(null,"next")}),window.location.hash.includes("#storyview")){var ffStoryViewButtons=document.querySelectorAll(".ff_storyview_button");ffStoryViewButtons.length>0&&(ffStoryviewBody.classList.add("ff_storyview_visible"),history.pushState("storyview",document.title+" Storyview","#storyview"),ffStoryViewButtons[0].click())}var TinyGesture=function(){function t(e,o){_classCallCheck(this,t),o=Object.assign({},t.defaults,o),this.element=e,this.opts=o,this.touchStartX=null,this.touchStartY=null,this.touchEndX=null,this.touchEndY=null,this.velocityX=null,this.velocityY=null,this.longPressTimer=null,this.doubleTapWaiting=!1,this.handlers={panstart:[],panmove:[],panend:[],swipeleft:[],swiperight:[],swipeup:[],swipedown:[],tap:[],doubletap:[],longpress:[]},this._onTouchStart=this.onTouchStart.bind(this),this._onTouchMove=this.onTouchMove.bind(this),this._onTouchEnd=this.onTouchEnd.bind(this),this.element.addEventListener("touchstart",this._onTouchStart,passiveIfSupported),this.element.addEventListener("touchmove",this._onTouchMove,passiveIfSupported),this.element.addEventListener("touchend",this._onTouchEnd,passiveIfSupported),!this.opts.mouseSupport||"ontouchstart"in window||(this.element.addEventListener("mousedown",this._onTouchStart,passiveIfSupported),document.addEventListener("mousemove",this._onTouchMove,passiveIfSupported),document.addEventListener("mouseup",this._onTouchEnd,passiveIfSupported))}return _createClass(t,[{key:"destroy",value:function(){this.element.removeEventListener("touchstart",this._onTouchStart),this.element.removeEventListener("touchmove",this._onTouchMove),this.element.removeEventListener("touchend",this._onTouchEnd),this.element.removeEventListener("mousedown",this._onTouchStart),document.removeEventListener("mousemove",this._onTouchMove),document.removeEventListener("mouseup",this._onTouchEnd),clearTimeout(this.longPressTimer),clearTimeout(this.doubleTapTimer)}},{key:"on",value:function(t,e){var o=this;if(this.handlers[t])return this.handlers[t].push(e),{type:t,fn:e,cancel:function(){return o.off(t,e)}}}},{key:"off",value:function(t,e){if(this.handlers[t]){var o=this.handlers[t].indexOf(e);-1!==o&&this.handlers[t].splice(o,1)}}},{key:"fire",value:function(t,e){for(var o=0;o<this.handlers[t].length;o++)this.handlers[t][o](e)}},{key:"onTouchStart",value:function(t){var e=this;this.thresholdX=this.opts.threshold("x",this),this.thresholdY=this.opts.threshold("y",this),this.disregardVelocityThresholdX=this.opts.disregardVelocityThreshold("x",this),this.disregardVelocityThresholdY=this.opts.disregardVelocityThreshold("y",this),this.touchStartX="mousedown"===t.type?t.screenX:t.changedTouches[0].screenX,this.touchStartY="mousedown"===t.type?t.screenY:t.changedTouches[0].screenY,this.touchMoveX=null,this.touchMoveY=null,this.touchEndX=null,this.touchEndY=null,this.longPressTimer=setTimeout(function(){return e.fire("longpress",t)},this.opts.longPressTime),this.fire("panstart",t)}},{key:"onTouchMove",value:function(t){if("mousemove"!==t.type||this.touchStartX&&null===this.touchEndX){var e=("mousemove"===t.type?t.screenX:t.changedTouches[0].screenX)-this.touchStartX;this.velocityX=e-this.touchMoveX,this.touchMoveX=e;var o=("mousemove"===t.type?t.screenY:t.changedTouches[0].screenY)-this.touchStartY;this.velocityY=o-this.touchMoveY,this.touchMoveY=o;var i=Math.abs(this.touchMoveX),s=Math.abs(this.touchMoveY);this.swipingHorizontal=i>this.thresholdX,this.swipingVertical=s>this.thresholdY,this.swipingDirection=i>s?this.swipingHorizontal?"horizontal":"pre-horizontal":this.swipingVertical?"vertical":"pre-vertical",Math.max(i,s)>this.opts.pressThreshold&&clearTimeout(this.longPressTimer),this.fire("panmove",t)}}},{key:"onTouchEnd",value:function(t){if("mouseup"!==t.type||this.touchStartX&&null===this.touchEndX){this.touchEndX="mouseup"===t.type?t.screenX:t.changedTouches[0].screenX,this.touchEndY="mouseup"===t.type?t.screenY:t.changedTouches[0].screenY,this.fire("panend",t),clearTimeout(this.longPressTimer);var e=this.touchEndX-this.touchStartX,o=Math.abs(e),i=this.touchEndY-this.touchStartY,s=Math.abs(i);(o>this.thresholdX||s>this.thresholdY)&&(this.swipedHorizontal=this.opts.diagonalSwipes?Math.abs(e/i)<=this.opts.diagonalLimit:o>=s&&o>this.thresholdX,this.swipedVertical=this.opts.diagonalSwipes?Math.abs(i/e)<=this.opts.diagonalLimit:s>o&&s>this.thresholdY,this.swipedHorizontal&&(e<0?(this.velocityX<-this.opts.velocityThreshold||e<-this.disregardVelocityThresholdX)&&this.fire("swipeleft",t):(this.velocityX>this.opts.velocityThreshold||e>this.disregardVelocityThresholdX)&&this.fire("swiperight",t)))}}}]),t}();TinyGesture.defaults={threshold:function(t,e){return Math.max(25,Math.floor(.15*("x"===t?window.innerWidth||document.body.clientWidth:window.innerHeight||document.body.clientHeight)))},velocityThreshold:10,disregardVelocityThreshold:function(t,e){return Math.floor(.5*("x"===t?e.element.clientWidth:e.element.clientHeight))},pressThreshold:8,diagonalSwipes:!1,diagonalLimit:Math.tan(.375*Math.PI),longPressTime:500,doubleTapTime:300,mouseSupport:!0};var passiveIfSupported=!1;try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:function(){passiveIfSupported={passive:!0}}}))}catch(t){}var touchOptions={velocityThreshold:5,mouseSupport:!1,disregardVelocityThreshold:function(t,e){return Math.floor(.1*("x"===t?e.element.clientWidth:e.element.clientHeight))}},touchTarget=document.querySelectorAll(".ff_storyview_blocks"),gestures=[];touchTarget.forEach(function(t){gestures.push(new TinyGesture(t,touchOptions))}),gestures.forEach(function(t){("ontouchstart"in window||window.DocumentTouch&&_instanceof(window.document,DocumentTouch)||window.navigator.maxTouchPoints||window.navigator.msMaxTouchPoints)&&(t.on("swiperight",function(t){stepStoryview(null,"previous")}),t.on("swipeleft",function(t){stepStoryview(null,"next")}))});